import exploitpaddingoracle

import urllib.request
import urllib.parse
import urllib.error

TARGET = 'http://crypto-class.appspot.com/po?er='
CIPHER = 'f20bdba6ff29eed7b046d1df9fb7000058b1ffb4210a580f748b4ac714c001bd4a61044426fb515dad3f21f18aa577c0bdf302936266926ff37dbf7035d5eeb4'
BLOCKSIZE = 16

class WebExamplePaddingOracle(metaclass=exploitpaddingoracle.PaddingOracle):
    def query(self, q):
        target = TARGET + urllib.parse.quote(q)  # Create query URL
        req = urllib.request.Request(target)     # Send HTTP request to server
        try:
            f = urllib.request.urlopen(req)      # Wait for response
        except urllib.error.HTTPError as e:          
            if e.code == 404:
                return True # good padding
            return False # bad padding
        
exampleOracle = WebExamplePaddingOracle()
attacker = exploitpaddingoracle.Attacker(exampleOracle, CIPHER, 16)
plaintext = attacker.attack() # Should return "The Magic Words are Squeamish Ossifrage"
print(plaintext)